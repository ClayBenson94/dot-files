#!/bin/bash
# updated interactive install script

# determine download command
if which curl &> /dev/null
then
    dlcmd="curl -L -o"
elif which wget &> /dev/null
then
    dlcmd="wget -O"
fi

# prepare a temp directory
dlpath="/tmp/dot-files"
echo "downloading dot-files to temporary path: ${dlpath}"
mkdir -p "$dlpath/.ssh" "$dlpath/.vim/doc" "$dlpath/.vim/undo"

# download dot-files explicitly
dotfiles=(".gitconfig" ".githelpers" ".promptrc" ".tmux.conf" ".vimrc" ".bashrc" ".bash_logout" ".bash_profile" ".ssh/config")
for f in ${dotfiles[*]}
do
    [ -f "src/${f}" ] && cp -R "src/${f}" "${dlpath}/${f}" || $dlcmd "${dlpath}/${f}" "https://raw.githubusercontent.com/cdelorme/dot-files/master/src/${f}"
done

# download ~/.git-completion
$dlcmd "$dlpath/.git-completion" "https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash"

# windows-condition
if [ $(uname) != "Linux" ] && [ $(uname) != "Darwin" ]
then
    rm "${dlpath}/.bash_profile" "${dlpath}/.ssh/config"
fi

# silent install or request confirmation
if [ "$1" == "-q" ]
then
    agree="y"
else
    while [ "$agree" != "y" ] && [ "$agree" != "n" ]
    do
        echo -n "are you sure you want to install dot-files? (y|n) "
        read agree
    done
fi

# acquire list of files to install
dfiles=$($(which ls) -1A "$dlpath/")

# install from temporary directory to home path
[ "$agree" = "y" ] && for f in ${dfiles[*]}; do cp -R "${dlpath}/${f}" "${HOME}/${f}"; done

# if root, attempt to install files to /etc/skel
[ "$agree" = "y" ] && [ $(id -u) -eq 0 ] && [ -d "/etc/skel" ] && for f in ${dfiles[*]}; do cp -R "${dlpath}/${f}" "/etc/skel/${f}"; done
