#!/bin/bash
# updated interactive install script

# files array (for handling which items get installed)
local_files=(".gitconfig" ".githelpers" ".promptrc" ".tmux.conf" ".vimrc" ".bashrc" ".bash_logout")
if [[ $(uname) != MINGW* ]]
then
    local_files="${local_files[*]} .bash_profile .ssh/config"
fi

# determine download command
if which curl &> /dev/null
then
    dlcmd="curl -L -o"
elif which wget &> /dev/null
then
    dlcmd="wget -O"
fi

# prepare a temp directory
dlpath="/tmp/dot-files"
echo "creating installation directory $dlpath"
mkdir -p "$dlpath/.ssh"

# copy or download files to temp directory
for f in ${local_files[*]}
do
    [ -f "src/${f}" ] && cp -R "src/${f}" "${dlpath}/${f}" || $dlcmd "${dlpath}/${f}" "https://raw.githubusercontent.com/cdelorme/dot-files/master/src/${f}"
done

# download ~/.git-completion
$dlcmd "$dlpath/.git-completion" "https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash"

# identify top-level files
files=$($(which ls) -1A "$dlpath/")

# silent install?
if [ "$1" == "-q" ]
then
    agree="y"
else
    # notify and confirm
    echo "files have been downloaded to $dlpath"
    echo "installation will replace the following files:"
    echo "$files"
    echo -n "do you wish to continue? (y|n)  "
    read agree
fi

# install files
[ $agree = "y" ] && for f in ${files[*]}; do cp -R "${dlpath}/${f}" "${HOME}/${f}"; done

# attempt to install files to /etc/skel
[ -d "/etc/skel" ] && for f in ${files[*]}; do cp -R "${dlpath}/${f}" "/etc/skel/${f}"; done